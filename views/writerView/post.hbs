<!-- Include external CSS. -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css">
{{!-- ckeditor --}}
<script src="https://cdn.ckeditor.com/4.16.1/standard-all/ckeditor.js"></script>

<div class="container-fluid">
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-md">
          <h4>{{topic}}</h4>
        </div>
      </div>
      <hr>
      {{#if article}}
      <div class="row">
        <div class="col" style="flex-basis : auto;">
          {{#if article.reasonForRefusing}}
            <div class="alert alert-danger" role="alert">
            {{!-- <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a> --}}
            <strong>Lý do bị từ chối: </strong>
            {{article.reasonForRefusing}}
            </div>
            {{/if}}
          {{#if hasSuccessPost}}
          <div class="alert alert-success" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            {{# each successPost }}
            {{ this }}</br>
            {{/ each }}
          </div>
          {{/if}}
          {{# if successold}}
          <div class="alert alert-success" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>Success!</strong>
            {{messagesSuccess}}
          </div>
          {{/if}}
          {{#if failure}}
          <div class="alert alert-danger" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>Failure!</strong>
            {{messagesFailure}}
          </div>
          {{/if}}
          {{# if hasError }}
          <div class="alert alert-danger" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            {{# each messages }}
            {{ this }}</br>
            {{/ each }}
          </div>
          {{ else }}
          {{# if hasSuccess }}
          <div class="alert alert-success" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            {{# each success }}
            {{ this }}</br>
            {{/ each }}
          </div>
          {{/ if }}
          {{/ if }}

          <form style="min-width: 20rem;" id="articleContent" action="{{action}}" method="POST" enctype="multipart/form-data">
            <div class="form-group row">
              <label for="text" class="col-12 col-form-label" >Tiêu đề bài viết</label>
              <div class="col-12">
                <input id="title" name="TieuDe" placeholder="Nhập tiêu đề tại đây" class="form-control here"
                  required="required" type="text" value="{{article.TieuDe}}">
              </div>
              <label for="text" class="col-12 col-form-label">Nội dung tóm tắt</label>
              <div class="col-12">
                <textarea id="abstract" name="TomTat" placeholder="Nhập nội dung tóm tắt tại đây" cols="40" rows="3"
                  class="form-control" required="required"> {{article.TomTat}} </textarea>
              </div>
            </div>
            <div class="form-group row">
              <label for="textarea" class="col-12 col-form-label">Nội dung chính bài viết</label>
              <div class="col-12">
                <textarea id="content" name="NoiDungChiTiet" 
                  required="required"> {{article.NoiDungChiTiet}} </textarea>
                {{!-- <script> $(function () { $('#content').froalaEditor() }); </script> --}}
              </div>
            </div>
            {{!-- <input type="text" id="_csrf" name="_csrf" value="{{csrfToken}}" hidden> --}}
            <input type="text" id="idBaiBao" name="idBaiBao" value="{{article.idBaiBao}}" hidden>
            <!--<input type="text" id="categoryMain" name="categoryMain" value="{{article.categoryMain}}" hidden>
            <input type="text" id="writeDate" name="writeDate" value="{{article.writeDate}}" hidden>
            <input type="text" id="postDate" name="postDate" value="{{article.postDate}}" hidden>
            <input type="text" id="writerMain" name="writerMain" value="{{article.writer}}" hidden>
            <input type="text" id="oldBigAvatar" name="oldBigAvatar" value="{{article.bigAvatar}}" hidden>-->
            <input type="text" id="oldAvatar" name="oldAvatar" value="{{article.AnhDaiDien}}" hidden>
            <input type="text" id="mode" value="edit" hidden>

        </div>
        <div class="col-md-auto">
            <div class="row justify-content-center">
              <img id="avatar" alt="User Pic" src="/img/BaiBao/{{article.AnhDaiDien}}" class="img-thumbnail img-fluid max-width: 100%">
              <input type="file" accept="image/*" name="file" id="file" hidden>
            </div>
            <div class="row justify-content-center">
              <button type="button" class="btn btn-md btn-outline-secondary fas fa-image m-2"
                onclick="handleChangeCover()"> Chọn ảnh cover</button>
            </div>
          <div class="card mb-3" style="max-width: 18rem;">
            <div class="card-header bg-light ">Đăng bài viết</div>
            <div class="card-body">
              <div class="form-group row">
                <label for="categorySub" class="col-12 col-form-label">Chuyên mục</label>
                <div class="col-12">
                  <select id="categorySub" name="idChuyenMucPhu" class="custom-select" required="required">
                   {{#each listSub}}
                    <option value="{{idChuyenMucPhu}}" 
                    {{#ifEquals idChuyenMucPhu ../article.idChuyenMucPhu}}
                    selected {{/ifEquals}}>{{TenChuyenMucPhu}}</option>
                    {{/each}}
                  </select>
                </div>
              </div>

              <div class="form-group row">
                
                <label for="isPremiumArticle" class="col-12 col-form-label">Chế độ Premium</label>
                <div class="col-8">
                  <select id="isPremiumArticle" name="Premium" class="custom-select" required="required">
    
                    <option value="1" {{#ifEquals article.Premium 1 }}selected{{/ifEquals}}> Yes </option>
                    <option value="0" {{#ifEquals article.Premium 0 }}selected{{/ifEquals}}> No </option>
                    
                  </select>
                </div>
              </div>

              <div class="form-group row">
                <label for="select" class="col-12 col-form-label">Chọn tag</label>
                <div class="col-8">
                  <select class="form-control chosen" multiple tabindex="4" name="arrayOfTags[]" id="arrayOfTags"
                    data-placeholder="Hãy chọn ít nhất một thẻ tag" style="width: 250px" required="required">
                    <option value=""></option>
                    {{# each tags }}
                    <option value="{{idTag}}" 
                    {{#ifIn idTag ../tagsOfNews}}selected
                    {{/ifIn}}>{{TenTag}}</option>
                    {{/ each }}
                    </select>
                </div>
              </div>

            </div>
            {{!-- <div class="card-footer bg-light">
              <button type="button" class="btn btn-outline-secondary btn-sm">Preview</button>
              <button type="button" class="btn btn-info btn-sm">Save Draft</button>
              <button type="submit" form="articleContent" class="btn btn-primary btn-sm">Publish</button>
            </div> --}}
            <div class="card-footer bg-light">
              {{!-- <button type="button" class="btn btn-outline-secondary btn-sm">Preview</button> --}}


              {{#if admin}}
              <button type="button" class="btn btn-primary btn-sm" onclick="handleSubmitPost2('{{action}}')">Save
                Draft</button>
                      {{#if_equal article.TinhTrangDuyet "Đã duyệt - Chờ xuất bản"}}
                      <button type="button" class="btn btn-success btn-sm" onclick="openApproveModal()" >Đổi ngày xuất
                        bản</button>

                      {{else}}
                      <button type="button" class="btn btn-success btn-sm" onclick="openApproveModal()">Xuất bản</button>
                      {{/if_equal}}

              {{else}}
              <button type="submit" class="btn btn-primary btn-sm" onclick="checkSubmit('{{action}}')">Save
                Draft</button>
              {{/if}}

            </div>
          </div>

        </div>
      </div>
      </form>
      {{/if}}
      {{#unless article}}
      <div class="row">
        <div class="col" style="flex-basis : auto;">
          {{# if successold}}
          <div class="alert alert-success" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>Success!</strong>
            {{messagesSuccess}}
          </div>
          {{/if}}
          {{# if failure}}
          <div class="alert alert-danger" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>Failure!</strong>
            {{messagesFailure}}
          </div>
          {{/if}}
          {{# if hasError }}
          <div class="alert alert-danger" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            {{# each messages }}
            {{ this }}</br>
            {{/ each }}
          </div>
          {{ else }}

          {{# if hasSuccess }}
          <div class="alert alert-success" role="alert">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            {{# each success }}
            {{ this }}</br>
            {{/ each }}
          </div>
          {{/ if }}

          {{/ if }}
          <form style="min-width: 20rem;" id="articleContent" action="{{actionpost}}" method="POST" enctype="multipart/form-data">
            <div class="form-group row">
              <label for="text" class="col-12 col-form-label">Tiêu đề bài viết</label>
              <div class="col-12">
                <input id="title" name="TieuDe" placeholder="Nhập tiêu đề tại đây" class="form-control here"
                  required="required" type="text">
              </div>
              <label for="text" class="col-12 col-form-label">Nội dung tóm tắt</label>
              <div class="col-12">
                <textarea id="abstract" name="TomTat" placeholder="Nhập nội dung tóm tắt tại đây" cols="80" rows="3"
                  class="form-control" required="required"></textarea>
              </div>
            </div>
            <div class="form-group row">
              <label for="textarea" class="col-12 col-form-label">Nội dung chính bài viết</label>
              <div class="col-12">
                <textarea id="content" name="NoiDungChiTiet"  rows="10" cols="80"
                  required="required"></textarea>
            </div>
            </div>

            {{!-- <input type="text" id="_csrf" name="_csrf" value="{{csrfToken}}" hidden> --}}
            <input type="text" id="mode" value="create" hidden>
        </div>
        <div class="col-md-auto">
            <div class="row justify-content-center">
              <img id="avatar" alt="User Pic" src="/img/68582787e5ca447e92ec49b9e3a9369b.jpeg" class="img-thumbnail img-fluid max-width: 100%">
              <input type="file" accept="image/*" name="file" id="file" hidden>
            </div>
            <div class="row justify-content-center">
              <button type="button" class="btn btn-md btn-outline-secondary fas fa-image m-2"
                onclick="handleChangeCover()"> Chọn ảnh cover</button>
            </div>
          <div class="card mb-3" style="max-width: 18rem;">
            <div class="card-header bg-light ">Đăng bài viết</div>
            <div class="card-body">
              <div class="form-group row">
                <label for="categorySub" class="col-12 col-form-label">Chọn chuyên mục</label>
                <div class="col-12">
                  <select id="categorySub" name="idChuyenMucPhu" class="custom-select" required="required">
                    <option value="" selected>Chọn chuyên mục</option>
                    {{#each listSub}}
                    <option value="{{idChuyenMucPhu}}">{{TenChuyenMucPhu}}</option>
                    {{/each}}
                  </select>
                </div>
              </div>

              <div class="form-group row">
                <label for="isPremiumArticle" class="col-12 col-form-label">Set Premium</label>
                <div class="col-8">
                  <select id="isPremiumArticle" name="Premium" class="custom-select" required="required">
                    <option value="" selected> -- set --</option>
                    
                    <option value="1"> Yes </option>
                    <option value="0"> No </option>
                    
                  </select>
                </div>
              </div>

              <div class="form-group row">
                <label for="select" class="col-12 col-form-label">Chọn tag</label>
                <div class="col-8">
                  <select class="form-control chosen" multiple tabindex="4" name="arrayOfTags" id="arrayOfTags"
                    data-placeholder="Hãy chọn ít nhất một thẻ tag" style="width: 250px" required="required" >
                    <option value=""></option>
                    {{# each tags }}
                    <option value="{{idTag}}">{{TenTag}}</option>
                    {{/ each }}
                    <!--{{# each article.arrayOfTags }}
                    <option value="{{this._id}}" selected>{{this.tagName}}</option>
                    {{/ each }}-->
                  </select>
                </div>
              </div>

            </div>
            <div class="card-footer bg-light">

              {{#if admin}}
              <button id="submit" type="submit" class="btn btn-primary btn-sm"
                onclick="handleSubmitPost2('{{actionpost}}')">Save Draft</button>
              {{else}}
              <button id="submit" type="submit" class="btn btn-primary btn-sm"
                onclick="checkSubmit('{{actionpost}}')">Save Draft</button>
              {{/if}}
            </div>
          </div>

        </div>
      </div>
      </form>
      {{/unless}}
    </div>
  </div>
</div>
<div class="modal" tabindex="-1" role="dialog" id="approveModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Duyệt bài viết</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="" method="POST" onsubmit="" id="approveForm">
          <div class="form-group">
            <label for="date">Chọn ngày</label>
            <input id="date" type="date" class="form-control" required>
          </div> <!-- form-group end.// -->
          <div class="form-group">
            <label for="time">Chọn giờ</label>
            <input id="time" type="time" class="form-control" required>
          </div> <!-- form-group end.// -->
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancel" class="btn btn-danger" data-dismiss="modal">Đóng</button>
        <button type="button" id="save" class="btn btn-success" onclick="handleApprove('{{article.id}}')">Xác
          nhận</button>
      </div>
    </div>
  </div>
</div>

{{!-- <script src="/javascript/prism.js" type="text/javascript" charset="utf-8"></script>
<script src="/javascript/init.js" type="text/javascript" charset="utf-8"></script> --}}
<script src="/js/writer-post.js" type="text/javascript"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
<script>$('.chosen').chosen();</script>
<script>
  CKEDITOR.replace("content",{
      extraPlugins: 'embed,autoembed,image2',
      height: 500,

      // Load the default contents.css file plus customizations for this sample.
      contentsCss: [
        'http://cdn.ckeditor.com/4.16.1/full-all/contents.css',
        'https://ckeditor.com/docs/ckeditor4/4.16.1/examples/assets/css/widgetstyles.css'
      ],
      // Setup content provider. See https://ckeditor.com/docs/ckeditor4/latest/features/media_embed
      embed_provider: '//ckeditor.iframe.ly/api/oembed?url={url}&callback={callback}',

      // Configure the Enhanced Image plugin to use classes instead of styles and to disable the
      // resizer (because image size is controlled by widget styles or the image takes maximum
      // 100% of the editor width).
      image2_alignClasses: ['image-align-left', 'image-align-center', 'image-align-right'],
      image2_disableResizer: true
    });
</script>
{{!-- <script src="/assets/js/multiple.select.js" type="text/javascript"></script> --}}